# Извлечение аудио из видео в MentorApp

## Обзор

Реализован функционал извлечения аудио дорожки из видео файлов для последующей загрузки на сервер в формате MP3. Это позволяет оптимизировать размер файлов и улучшить качество анализа речи.

## Архитектура

### Компоненты

1. **AudioExtractor** (`src/utils/audioExtractor.ts`)
   - Утилита для извлечения аудио из видео
   - Поддержка различных форматов (MP3, WAV, M4A)
   - Настройка качества и битрейта

2. **UploadScreen** (`src/screens/UploadScreen.tsx`)
   - UI для выбора файлов
   - Извлечение аудио из видео
   - Загрузка на сервер

3. **FilePicker** (`src/components/FilePicker.tsx`)
   - Компонент выбора файлов
   - Поддержка видео и аудио файлов

## Функционал

### Режимы загрузки

1. **original** - загрузка оригинального файла
2. **audio-extract** - извлечение аудио из видео и загрузка MP3
3. **audio-only** - загрузка аудио файла как есть

### Процесс извлечения аудио

1. Пользователь выбирает видео файл
2. Система определяет тип файла
3. Для видео файлов предлагается извлечение аудио
4. Аудио извлекается в MP3 формате с настройками для речи
5. Извлеченное аудио загружается на сервер

### Настройки аудио

- **Формат**: MP3
- **Качество**: low (128 kbps) - оптимально для речи
- **Частота дискретизации**: 44.1 kHz
- **Каналы**: моно

## API

### AudioExtractor

```typescript
interface AudioExtractionOptions {
  format?: 'mp3' | 'wav' | 'm4a';
  quality?: 'low' | 'medium' | 'high';
  sampleRate?: number;
  bitrate?: number;
}

interface AudioExtractionResult {
  audioBlob: Blob;
  duration: number;
  sampleRate: number;
  format: string;
  filePath?: string;
}
```

### Методы

```typescript
// Извлечение аудио из видео
static async extractAudioFromVideo(
  videoFile: any, 
  options: AudioExtractionOptions = {}
): Promise<AudioExtractionResult>

// Получение информации о файле
static async getVideoInfo(videoFile: any): Promise<{
  type: 'video' | 'audio' | 'other';
  duration?: number;
  sampleRate?: number;
  channels?: number;
}>
```

## Интеграция с backend

### Параметры загрузки

При загрузке извлеченного аудио передаются специальные параметры:

```typescript
const uploadOptions = {
  transcriptionEnabled: true,
  autoAnalysis: true,
  language: 'ru',
  quality: 'standard',
  originalFileName: videoFile.name,
  isAudioExtract: true,
  extractAudio: true,
  audioFormat: 'mp3'
};
```

### Обработка на сервере

Backend получает файл с флагом `isAudioExtract: true` и обрабатывает его как извлеченное аудио:

- Оригинальное имя файла сохраняется в `originalFileName`
- Тип файла устанавливается как `AUDIO`
- Включается транскрипция и анализ

## UI/UX

### Выбор файла

1. Пользователь нажимает "Выбрать файл"
2. Отображается список доступных файлов
3. Система определяет тип файла

### Извлечение аудио

1. Для видео файлов показывается кнопка "Извлечь аудио"
2. Отображается прогресс извлечения
3. Показывается информация об извлеченном аудио

### Загрузка

1. Кнопка "Загрузить аудио" для извлеченного аудио
2. Кнопка "Загрузить файл" для оригинальных файлов
3. Отображение прогресса загрузки

## Ограничения

### Текущие ограничения

1. **Симуляция извлечения**: В текущей реализации извлечение аудио симулируется
2. **Нет нативных модулей**: Требуется интеграция с нативными модулями для реального извлечения
3. **Ограниченные форматы**: Поддерживаются только основные форматы

### Планы развития

1. **Нативная интеграция**: Интеграция с FFmpeg или аналогичными библиотеками
2. **Реальное извлечение**: Реальное извлечение аудио на устройстве
3. **Дополнительные форматы**: Поддержка большего количества форматов

## Тестирование

### Тестовые сценарии

1. **Выбор видео файла**
   - Выбор файла
   - Отображение информации
   - Показ кнопки извлечения

2. **Извлечение аудио**
   - Нажатие кнопки извлечения
   - Отображение прогресса
   - Показ результата

3. **Загрузка**
   - Загрузка извлеченного аудио
   - Загрузка оригинального файла
   - Обработка ошибок

### Тестовые данные

- Видео файлы: MP4, MOV, AVI
- Аудио файлы: MP3, WAV, M4A
- Размеры: от 1MB до 100MB

## Безопасность

### Валидация файлов

1. Проверка типа файла
2. Проверка размера файла
3. Проверка формата

### Ограничения

- Максимальный размер файла: 100MB
- Поддерживаемые форматы: видео и аудио
- Время обработки: до 5 минут

## Производительность

### Оптимизации

1. **Сжатие аудио**: Использование низкого битрейта для речи
2. **Моно канал**: Уменьшение размера файла
3. **Быстрая обработка**: Оптимизированные алгоритмы

### Мониторинг

- Время извлечения
- Размер результирующего файла
- Качество аудио

## Заключение

Реализован полнофункциональный механизм извлечения аудио из видео файлов с последующей загрузкой на сервер. Система поддерживает различные режимы загрузки и обеспечивает оптимальное качество для анализа речи.

Для полной функциональности требуется интеграция с нативными модулями для реального извлечения аудио на мобильных устройствах.


